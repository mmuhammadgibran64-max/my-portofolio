<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard M Gibran - SIT</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        
        .container { max-width: 500px; width: 90%; background: var(--card); padding: 40px; border-radius: 25px; text-align: center; box-shadow: 0 15px 50px rgba(0,0,0,0.6); border: 1px solid #334155; }
        
        /* Navigasi Halaman */
        #login-box { display: block; }
        #dashboard-box { display: none; }

        .banner { width: 100%; padding: 25px 0; background: linear-gradient(135deg, #0ea5e9, #6366f1); border-radius: 20px; margin-bottom: 30px; }
        #clock { font-size: 3em; font-weight: bold; text-shadow: 2px 2px 10px rgba(0,0,0,0.3); }
        
        .welcome-text { font-size: 1.2em; color: var(--primary); font-weight: 600; margin-bottom: 10px; }
        .empty-dash { border: 2px dashed #475569; padding: 60px 20px; border-radius: 15px; color: #94a3b8; margin: 20px 0; }
        
        .btn-logout { background: #ef4444; color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-logout:hover { background: #dc2626; transform: scale(1.05); }
    </style>
</head>
<body>

<div id="login-box" class="container">
    <div class="banner">
        <h2 style="margin:0;">GIBRAN PORTFOLIO</h2>
        <p style="opacity: 0.9; font-size: 14px;">Dashboard Access</p>
    </div>
    
    <p class="welcome-text">Selamat Datang</p>
    <p style="font-size: 14px; color: #94a3b8; margin-bottom: 30px;">Klik tombol di bawah untuk masuk dan mencatat data ke sheet <b>daftar</b></p>

    <div style="display: flex; justify-content: center;">
        <div id="g_id_onload"
             data-client_id="594310366887-8b30jrckuekb2do01g1b9kl29lh3l9j6.apps.googleusercontent.com"
             data-context="signin"
             data-ux_mode="popup"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_blue" data-size="large" data-text="signin_with"></div>
    </div>
    <p id="status" style="margin-top: 20px; font-size: 13px; color: #38bdf8;"></p>
</div>

<div id="dashboard-box" class="container">
    <div class="banner">
        <div id="clock">00:00:00</div>
        <p style="margin: 5px 0 0 0; font-weight: bold;">SIT DASHBOARD AKTIF</p>
    </div>

    <div class="empty-dash">
        <p id="user-greeting">ðŸ‘‹ Halo!</p>
        <p style="font-size: 12px; margin-top: 10px;">Data login kamu (Nama & Email) sudah otomatis masuk ke Google Sheet "daftar".</p>
        <hr style="border: 0; border-top: 1px solid #334155; margin: 20px 0;">
        <p style="font-size: 14px; color: var(--primary);">[ Dashboard Kosongan - Siap Diisi ]</p>
    </div>

    <button class="btn-logout" onclick="location.reload()">LOGOUT</button>
</div>

<script>
    // 1. FUNGSI JAM DIGITAL
    setInterval(() => {
        const clockEl = document.getElementById('clock');
        if(clockEl) {
            clockEl.innerText = new Date().toLocaleTimeString('id-ID');
        }
    }, 1000);

    // 2. FUNGSI DECODE DATA GOOGLE (Mengambil Nama & Email)
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    };

    // 3. FUNGSI HANDLE LOGIN
    function handleCredentialResponse(response) {
        const statusEl = document.getElementById('status');
        statusEl.innerText = "Mencatat profil Anda ke Sheet...";

        // Bongkar data profil asli
        const responsePayload = parseJwt(response.credential);
        const namaAsli = responsePayload.name;
        const emailAsli = responsePayload.email;

        // LINK APPS SCRIPT ANDA
        const scriptURL = "https://script.google.com/macros/s/AKfycbwCZnpxtHpRv3NyX3xA1YkAlQcUO9KE-Ilf0Uz_5dB2vxLcK57lKxa_A7drSlEY4J6hWg/exec";

        // Kirim Nama & Email ke Google Sheets
        fetch(scriptURL + "?nama=" + encodeURIComponent(namaAsli) + "&hp=" + encodeURIComponent(emailAsli))
        .then(() => {
            // Berhasil: Pindah ke Dashboard
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('dashboard-box').style.display = 'block';
            document.getElementById('user-greeting').innerHTML = "ðŸ‘‹ Halo, <b>" + namaAsli + "</b>!";
        })
        .catch(err => {
            // Tetap masuk dashboard walau fetch gagal (masalah jaringan)
            console.error("Gagal lapor:", err);
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('dashboard-box').style.display = 'block';
        });
    }
</script>

</body>
</html>
