<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gibran | Dual System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #050505; --card: #111; --accent: #ff9800; --blue: #00d2ff; --text: #fff; --border: #222; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: auto; padding: 20px; }
        
        /* NAVIGASI ATAS */
        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .btn-logout { color: #ff4444; text-decoration: none; font-weight: bold; font-size: 12px; border: 1px solid #421111; padding: 5px 12px; border-radius: 8px; }
        #clock { color: var(--accent); font-weight: bold; font-family: monospace; }

        /* PROFIL (TETAP ADA) */
        .banner { width: 100%; height: 140px; background: linear-gradient(45deg, #1a1a1a, #000); border-radius: 20px; margin-top: 10px; border: 1px solid var(--border); overflow: hidden; }
        .banner img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--bg); background: #222; margin-top: -45px; margin-left: 20px; position: relative; object-fit: cover; }
        
        .intro { padding: 10px 20px; }
        .intro h1 { margin: 0; font-size: 22px; color: var(--accent); }
        .intro p.sub { color: #888; margin: 5px 0 15px; font-size: 13px; }
        .desc-box { background: #0a0a0a; padding: 15px; border-radius: 15px; font-size: 13px; line-height: 1.5; color: #bbb; border: 1px solid #1a1a1a; text-align: justify; }

        /* SKILLS (TETAP ADA) */
        .section { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin: 20px 0; }
        .section h3 { margin-top: 0; color: var(--accent); font-size: 15px; border-bottom: 1px solid #222; padding-bottom: 8px; }
        .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .skill-card { background: #000; padding: 10px; border-radius: 10px; border: 1px solid #222; }
        .skill-card b { font-size: 12px; color: #fff; display: block; }
        .skill-card p { font-size: 11px; color: #666; margin: 3px 0 0; }

        /* --- AREA UPLOAD 1: GIBRAN SYSTEM (ORANYE) --- */
        .upload-panel-1 { background: #1a150e; border: 2px dashed var(--accent); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px; }
        .btn-upload-1 { background: var(--accent); color: #000; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; border: none; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* --- AREA UPLOAD 2: SIMPAN FILE DAN DLL (BIRU) --- */
        .upload-panel-2 { background: #0a151a; border: 2px dashed var(--blue); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px; }
        .btn-upload-2 { background: var(--blue); color: #000; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; border: none; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; }

        #status { font-size: 12px; margin-top: 10px; color: #fff; font-weight: bold; }

        /* GALLERY LIST */
        .gallery-title { margin: 25px 0 10px; font-size: 14px; color: #555; font-weight: bold; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .gallery-item { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid var(--border); margin-bottom: 15px; padding: 10px; display: flex; align-items: center; gap: 15px; }
        .gallery-item img { width: 60px; height: 60px; object-fit: cover; border-radius: 10px; background: #000; flex-shrink: 0; }
        .item-info { flex-grow: 1; overflow: hidden; }
        .item-name { font-size: 13px; font-weight: bold; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item-date { font-size: 10px; color: #666; }
        .item-actions { display: flex; gap: 5px; margin-top: 5px; }
        .btn-sm { padding: 6px 10px; border-radius: 6px; border: none; font-size: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div id="clock">00:00:00</div>
        <a href="index.html" class="btn-logout"><i class="fas fa-sign-out-alt"></i> LOGOUT</a>
    </div>

    <div class="container">
        <div class="banner">
            <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=600" alt="Banner">
        </div>
        <img src="https://ui-avatars.com/api/?name=Gibran&background=ff9800&color=000&size=128" class="profile-pic">
        
        <div class="intro">
            <h1 id="display-nama">Gibran</h1>
            <p class="sub">Humas LP3I | Video Editor | Graphic Designer</p>
            <div class="desc-box">
                Disiplin, cepat beradaptasi, dan memiliki pengalaman monitoring di Gatot Subroto. Siap berkontribusi dalam tim kreatif dan operasional.
            </div>
        </div>

        <div class="section">
            <h3><i class="fas fa-tools"></i> Keahlian</h3>
            <div class="skill-list">
                <div class="skill-card"><b>Desain Grafis</b><p>Poster & Konten</p></div>
                <div class="skill-card"><b>Video Editing</b><p>Premiere Pro</p></div>
            </div>
        </div>

        <div class="upload-panel-1">
            <h3 style="color: var(--accent); margin:0 0 10px 0;">GIBRAN SYSTEM</h3>
            <input type="file" id="fileInput1" hidden onchange="prosesUpload(this, 'System')">
            <button class="btn-upload-1" onclick="document.getElementById('fileInput1').click()">
                <i class="fas fa-camera"></i> UPLOAD FOTO / SYSTEM
            </button>
        </div>

        <div class="upload-panel-2">
            <h3 style="color: var(--blue); margin:0 0 10px 0;">SIMPAN FILE DAN DLL</h3>
            <p style="font-size:11px; color:#888; margin-top:-5px;">Arsip Dokumen, PDF, Data Penting</p>
            <input type="file" id="fileInput2" hidden onchange="prosesUpload(this, 'File Simpan')">
            <button class="btn-upload-2" onclick="document.getElementById('fileInput2').click()">
                <i class="fas fa-folder-plus"></i> UPLOAD FILE ARSIP
            </button>
        </div>

        <div id="status" style="text-align:center;">Sistem & Penyimpanan Ready</div>

        <div class="gallery-title">RIWAYAT SYSTEM & FILE</div>
        <div id="gallery"></div>
    </div>

    <script>
        // --- KONFIGURASI SAKTI ---
        const CLOUD_NAME = "dumqnwl9g"; 
        const UPLOAD_PRESET = "cloud simpan"; // Pastikan nama ini sesuai (Unsigned)
        const URL_SHEETS = "https://script.google.com/macros/s/AKfycbzeisUeZYTsQM0qjbvhuda9wkG9wBDb99x4q4AdqGzVeRUY0Gu68P61NpCmuOQomXki0Q/exec";

        window.onload = function() {
            document.getElementById('display-nama').innerText = localStorage.getItem('user_name') || "Gibran";
            setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
            muatGaleri();
        };

        // --- FUNGSI UPLOAD (Support 2 Tombol) ---
        async function prosesUpload(input, sumber) {
            const file = input.files[0];
            const statusDiv = document.getElementById('status');
            if (!file) return;

            statusDiv.innerHTML = "⏳ Mengunggah ke " + sumber + "...";

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);

            try {
                // Pakai mode /auto/upload biar file PDF/ZIP masuk
                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = "✅ Berhasil Disimpan di " + sumber + "!";
                    
                    let koleksi = JSON.parse(localStorage.getItem('gibran_gallery')) || [];
                    
                    // Deteksi Ikon
                    let preview = data.secure_url;
                    let ikon = "fas fa-image"; // Default ikon gambar
                    
                    if (data.resource_type !== "image") {
                        preview = "https://cdn-icons-png.flaticon.com/512/2965/2965335.png"; // Ikon File
                        ikon = "fas fa-file-alt";
                    }

                    koleksi.unshift({
                        id: Date.now(),
                        url: data.secure_url,
                        preview: preview,
                        nama: file.name,
                        tipe: data.format || 'file',
                        sumber: sumber, // Penanda ini dari System atau Simpan File
                        tgl: new Date().toLocaleString()
                    });

                    localStorage.setItem('gibran_gallery', JSON.stringify(koleksi));
                    
                    // Lapor ke Sheets
                    fetch(URL_SHEETS, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            nama: localStorage.getItem('user_name'),
                            aktivitas: "Upload " + sumber,
                            detail: data.secure_url
                        })
                    });

                    muatGaleri();
                } else {
                    statusDiv.innerHTML = "❌ Gagal: " + data.error.message;
                }
            } catch (err) {
                statusDiv.innerHTML = "❌ Error Koneksi Internet.";
            }
        }

        // --- TAMPILAN GALERI LEBIH RAPI ---
        function muatGaleri() {
            const container = document.getElementById('gallery');
            const koleksi = JSON.parse(localStorage.getItem('gibran_gallery')) || [];
            
            if (koleksi.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#444; font-size:12px; padding:20px;'>Belum ada file tersimpan.</p>";
                return;
            }

            container.innerHTML = koleksi.map(item => `
                <div class="gallery-item">
                    <img src="${item.preview}" style="object-fit:contain; background:#111;">
                    <div class="item-info">
                        <div class="item-name" style="color:${item.sumber === 'File Simpan' ? '#00d2ff' : '#ff9800'}">
                            ${item.nama}
                        </div>
                        <div class="item-date">
                            <i class="fas fa-clock"></i> ${item.tgl} &bull; 
                            <span style="color:#aaa">${item.sumber || 'System'}</span>
                        </div>
                        <div class="item-actions">
                            <button class="btn-sm" style="background:#333; color:#fff;" onclick="window.open('${item.url}')">BUKA</button>
                            <button class="btn-sm" style="background:#222; color:#ff4444;" onclick="hapus('${item.id}')">HAPUS</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function hapus(id) {
            if(confirm("Hapus file ini?")) {
                let koleksi = JSON.parse(localStorage.getItem('gibran_gallery')) || [];
                koleksi = koleksi.filter(i => i.id != id);
                localStorage.setItem('gibran_gallery', JSON.stringify(koleksi));
                muatGaleri();
            }
        }
    </script>
</body>
</html>
