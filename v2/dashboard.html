<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gibran - All in One</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; font-family: 'Poppins', sans-serif; }
        .main-card { border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn-menu { border-radius: 12px; padding: 15px; font-weight: bold; transition: 0.3s; margin-bottom: 10px; }
        .btn-menu:hover { transform: scale(1.02); }
        #clock { font-size: 1.2rem; font-weight: bold; color: #555; }
        .gallery-item { background: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .gallery-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <span class="navbar-brand fw-bold">üöÄ GIBRAN DASHBOARD</span>
            <span id="clock" class="text-white">00:00:00</span>
        </div>
    </nav>

    <div class="container">
        <div class="card main-card p-4 mb-4 text-center">
            <h4>Halo, <span id="display-nama" class="text-primary">Gibran</span>! üëã</h4>
            <p class="text-muted">Selamat datang kembali di pusat kendali lo.</p>
        </div>

        <div class="card main-card p-4 mb-4">
            <h5 class="fw-bold"><i class="fas fa-cloud-upload-alt text-primary"></i> Simpan File ke Cloud</h5>
            <input type="file" id="fileInput" class="form-control mb-2" onchange="prosesUpload(this, 'File Simpan')">
            <div id="status" class="small text-muted mb-3 text-center"></div>
            
            <hr>
            
            <h5 class="fw-bold mb-3">üìÇ Galeri File Lo</h5>
            <div id="gallery">
                </div>
        </div>

        <div class="row">
            <div class="col-12">
                <a href="shop/index.html" class="btn btn-danger btn-lg w-100 btn-menu shadow">
                    <i class="fas fa-shopping-basket"></i> üõí TOKO ONLINE
                </a>
                
                <button onclick="window.open('https://meet.google.com/new', '_blank')" class="btn btn-success btn-lg w-100 btn-menu shadow">
                    <i class="fas fa-video"></i> MULAI GOOGLE MEET
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI CLOUD ---
        const CLOUD_NAME = "dumqnwl9g"; 
        const UPLOAD_PRESET = "cloud simpan"; 
        const URL_SHEETS = "https://script.google.com/macros/s/AKfycbzeisUeZYTsQM0qjbvhuda9wkG9wBDb99x4q4AdqGzVeRUY0Gu68P61NpCmuOQomXki0Q/exec";

        window.onload = function() {
            // Ambil Nama
            const nama = localStorage.getItem('namaUser') || localStorage.getItem('user_name') || "Gibran";
            document.getElementById('display-nama').innerText = nama;
            
            // Jam
            setInterval(() => { 
                document.getElementById('clock').innerText = new Date().toLocaleTimeString('id-ID'); 
            }, 1000);
            
            muatGaleri();
        };

        // --- FUNGSI UPLOAD CLOUD ---
        async function prosesUpload(input, sumber) {
            const file = input.files[0];
            const statusDiv = document.getElementById('status');
            if (!file) return;

            statusDiv.innerHTML = "‚è≥ Mengunggah...";
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);

            try {
                const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: 'POST', body: formData });
                const data = await res.json();

                if (res.ok) {
                    statusDiv.innerHTML = "‚úÖ Berhasil Disimpan!";
                    let koleksi = JSON.parse(localStorage.getItem('gibran_gallery')) || [];
                    koleksi.unshift({
                        id: Date.now(),
                        url: data.secure_url,
                        nama: file.name,
                        tgl: new Date().toLocaleString()
                    });
                    localStorage.setItem('gibran_gallery', JSON.stringify(koleksi));
                    
                    // Lapor Sheets Log
                    fetch(URL_SHEETS, {
                        method: 'POST', mode: 'no-cors',
                        body: JSON.stringify({ nama: localStorage.getItem('namaUser'), aktivitas: "Upload " + sumber, detail: data.secure_url })
                    });
                    muatGaleri();
                }
            } catch (err) { statusDiv.innerHTML = "‚ùå Gagal Upload."; }
        }

        function muatGaleri() {
            const container = document.getElementById('gallery');
            const koleksi = JSON.parse(localStorage.getItem('gibran_gallery')) || [];
            if (koleksi.length === 0) {
                container.innerHTML = "<p class='text-center small'>Belum ada file.</p>";
                return;
            }
            container.innerHTML = koleksi.map(item => `
                <div class="gallery-item shadow-sm">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-file-alt text-primary me-2"></i>
                        <span class="small fw-bold">${item.nama.substring(0, 15)}...</span>
                    </div>
                    <button onclick="window.open('${item.url}', '_blank')" class="btn btn-sm btn-outline-primary">Lihat</button>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
