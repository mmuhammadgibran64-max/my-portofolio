<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gibran Chat</title>
</head>
<body style="background: #000; color: white; font-family: sans-serif; padding: 20px; text-align: center;">

    <div style="max-width: 400px; margin: 0 auto; border: 2px solid #00ff88; padding: 20px; border-radius: 15px;">
        <h2 style="color: #00ff88;">GIBRAN CHAT</h2>
        
        <div id="lampu" style="background: grey; padding: 10px; border-radius: 5px; font-weight: bold; margin-bottom: 10px;">
            MENGECEK KONEKSI...
        </div>

        <div id="chatBox" style="height: 250px; overflow-y: auto; background: #111; border: 1px solid #333; padding: 10px; margin-bottom: 10px; text-align: left;">
            </div>

        <input id="inputPesan" type="text" placeholder="Ketik pesan..." style="width: 70%; padding: 10px;">
        <button onclick="kirim()" style="padding: 10px; background: #00ff88; border: none; font-weight: bold; cursor: pointer;">KIRIM</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Config Proyek Telepon Online
        const firebaseConfig = {
            apiKey: "AIzaSyBD0e8fgraMN0hHvKDup9UNNAXgC036Ioo",
            authDomain: "telepon-online.firebaseapp.com",
            projectId: "telepon-online",
            databaseURL: "https://telepon-online-default-rtdb.firebaseio.com"
        };

        // Inisialisasi
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // Pastikan elemen HTML siap
        document.addEventListener("DOMContentLoaded", function() {
            const lampu = document.getElementById('lampu');
            const box = document.getElementById('chatBox');

            // Monitor Koneksi
            db.ref(".info/connected").on("value", (snap) => {
                if (snap.val() === true) {
                    lampu.style.background = "#00ff88";
                    lampu.style.color = "#000";
                    lampu.innerHTML = "STATUS: TERHUBUNG";
                } else {
                    lampu.style.background = "red";
                    lampu.style.color = "#fff";
                    lampu.innerHTML = "STATUS: TERPUTUS";
                }
            });

            // Tampilkan Chat (Ambil dari folder 'chat_public')
            db.ref("chat_public").limitToLast(20).on("child_added", (snap) => {
                const data = snap.val();
                const msgDiv = document.createElement("div");
                msgDiv.style.marginBottom = "5px";
                msgDiv.innerHTML = `<b style="color:#00ff88">${data.nama}:</b> <span></span>`;
                msgDiv.querySelector("span").textContent = data.pesan;
                box.appendChild(msgDiv);
                box.scrollTop = box.scrollHeight;
            });
        });

        // Fungsi Kirim
        function kirim() {
            const input = document.getElementById('inputPesan');
            if(input.value.trim() !== "") {
                db.ref("chat_public").push().set({
                    nama: "Gibran",
                    pesan: input.value,
                    waktu: Date.now()
                });
                input.value = "";
            }
        }

        // Kirim pakai Enter
        document.getElementById('inputPesan').addEventListener("keypress", function(e) {
            if (e.key === "Enter") kirim();
        });
    </script>
</body>
</html>
