<!DOCTYPE html>
<html>
<head>
    <title>Chat Baru Gibran</title>
</head>
<body style="background-color: white; color: black; padding: 20px;">

    <h1>TEST CHAT BARU</h1>
    <p>Kalau tulisan ini muncul, berarti file baru BERHASIL dibuat.</p>
    
    <h3 id="status" style="color: red;">STATUS: MENUNGGU KONEKSI...</h3>

    <div id="kotakPesan" style="border: 2px solid black; height: 200px; overflow: scroll; margin-bottom: 10px; padding: 10px; background: #eee;">
    </div>

    <input type="text" id="inputPesan" placeholder="Ketik pesan..." style="width: 60%; padding: 10px;">
    <button onclick="kirim()" style="padding: 10px; background: blue; color: white;">KIRIM PESAN</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAGVgvcYQbiB47e_zKRqfL18pEgJvCP7vs",
            authDomain: "chat-otomatis-20ee5.firebaseapp.com",
            projectId: "chat-otomatis-20ee5",
            databaseURL: "https://chat-otomatis-20ee5-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. Cek Koneksi
        db.ref(".info/connected").on("value", (snap) => {
            const st = document.getElementById("status");
            if (snap.val() === true) {
                st.innerHTML = "STATUS: TERHUBUNG (HIJAU)!";
                st.style.color = "green";
            } else {
                st.innerHTML = "STATUS: TERPUTUS (MERAH)...";
                st.style.color = "red";
            }
        });

        // 2. Kirim Pesan
        function kirim() {
            const teks = document.getElementById("inputPesan").value;
            if(teks !== "") {
                db.ref("chat_final").push().set({
                    nama: "Gibran",
                    pesan: teks
                });
                document.getElementById("inputPesan").value = "";
            }
        }

        // 3. Tampilkan Pesan
        db.ref("chat_final").on("child_added", (snap) => {
            const data = snap.val();
            const kotak = document.getElementById("kotakPesan");
            kotak.innerHTML += "<p><b>" + data.nama + ":</b> " + data.pesan + "</p>";
            kotak.scrollTop = kotak.scrollHeight;
        });
    </script>

</body>
</html>
