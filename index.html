<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="google-site-verification" content="LRrECCoCFBiw5F-wnLPQ4zoDpwyqWaahByQGTxJPIzg" />

    <title>Gibran Store - Welcome</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        body { 
            background: radial-gradient(circle, #222 0%, #111 100%); 
            color: white; font-family: 'Segoe UI', sans-serif; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; margin: 0; text-align: center; 
        }
        .login-box { 
            border: 2px solid #ff9800; 
            padding: 40px; 
            border-radius: 25px; 
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(255, 152, 0, 0.3);
            max-width: 400px;
            width: 90%;
        }
        h1 { color: #ff9800; font-weight: bold; margin-bottom: 5px; letter-spacing: 2px; }
        .status-online { color: #4caf50; font-size: 0.85rem; font-weight: bold; margin-bottom: 25px; text-transform: uppercase; }
        .loading-text { display: none; color: #ff9800; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="login-box">
        <h1>GIBRAN STORE üöÄ</h1>
        <p class="status-online">‚óè SYSTEM ONLINE (v2.0)</p>
        
        <p class="text-light mb-4">Selamat datang, Sobat Gibran!<br>Silakan masuk untuk akses Dashboard & Toko.</p>

        <div id="g_id_onload"
             data-client_id="594310366887-554m54bf3o761r82ptmd3ja8pq0f2t6d.apps.googleusercontent.com" 
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin d-flex justify-content-center" data-type="standard"></div>

        <div id="loading-msg" class="loading-text">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            Mendaftarkan data ke Sheet...
        </div>

        <p class="mt-4 small" style="opacity: 0.5;">¬© 2026 Muhammad Gibran</p>
    </div>

    <script>
        async function handleCredentialResponse(response) {
            // Tampilkan pesan loading
            document.getElementById('loading-msg').style.display = 'block';
            
            try {
                // 1. Decode data dari Google
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                // 2. Simpan ke LocalStorage agar Dashboard v2 bisa baca
                localStorage.setItem('namaUser', payload.name);
                localStorage.setItem('fotoUser', payload.picture);
                localStorage.setItem('emailUser', payload.email);

                // 3. KIRIM DATA KE GOOGLE SHEET "daftar sekarang"
                // Menggunakan link Apps Script yang kamu berikan
                const urlSheet = 'https://script.google.com/macros/s/AKfycbykArHNH2A0OGrlhl3JJFcFPCEZcIK75ky38KjupZpPVfNaHw3Bx4CFW6CBnXFMXgX_9Q/exec';

                await fetch(urlSheet, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        "namaUser": payload.name,
                        "emailUser": payload.email,
                        "fotoUser": payload.picture,
                        "waktu": new Date().toLocaleString('id-ID')
                    })
                });

                // 4. Kasih jeda sebentar lalu pindah ke dashboard
                setTimeout(() => {
                    window.location.href = "v2/dashboard.html";
                }, 1000);

            } catch (error) {
                console.error("Gagal proses:", error);
                alert("Login berhasil, tapi gagal lapor ke Sheet. Tetap masuk ke Dashboard...");
                window.location.href = "v2/dashboard.html";
            }
        }
    </script>

    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/6993e93bd5bd3b1c3ca44cb6/1jhkse4p6';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>

</body>
</html>
